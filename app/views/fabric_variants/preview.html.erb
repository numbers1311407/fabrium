<style>
  body { padding: 0; margin: 0; }
</style>

<%= form_tag preview_fabric_variants_path, multipart: true, id: "image_preview_form", class: 'form-inline' do %>
  <%= file_field_tag :image %>
<% end %>
 
<script>
  //automatically submit the form
  document.getElementById("image").onchange = function() {
    document.getElementById("image_preview_form").submit();
  };
  
  <% if @image %>
  // if an image was uploaded, replace the relevant parts of the parent form
  var pwin = window.parent, pdoc = pwin.document;
  pdoc.getElementById("fabric_variant_image_crop").value = null;
  pdoc.getElementById("fabric_variant_retained_image").value = "<%= @retained_image %>";
  var imgs = pdoc.getElementsByClassName("fabric_image");
  for (var i=0; i<imgs.length; i++) { imgs[i].src = "<%= @image.url  %>"; }

  pwin.crop.open();
  <% end %>
</script>
