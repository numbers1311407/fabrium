<%= content_for :body_end do %>
  <%= javascript_include_tag :client %>
<% end %>

<div>
  <div ng-view></div>

  <script type="text/ng-template" id="index.html">
    <div class="panel panel-default">
      <div class="panel-body">
        <form role="form" class="form-search" ng-submit="updateSearch(1)">
          <fieldset>
            <legend>Search Fabrics</legend>

            <div class="row">
              <div class="form-group">
                <label>Category</label>
                <select 
                  selectize="selectize.category"
                  ng-model="search.category" 
                  class="form-control"
                  placeholder="Select..."
                >
                  <%= select_options_for_categories %>
                </select>
              </div>

              <div class="form-group form-group-fiber">
                <label>Fiber Content</label>
                <select
                  selectize="selectize.fiber" 
                  ng-model="search.fiber" 
                  class="form-control" 
                  placeholder="Select..."
                >
                  <%= select_options_for_fiber %>
                </select>
              </div>

              <div class="form-group form-group-weights">
                <label>Weight</label>
                <input type="number" ng-model="search.weight_min" class="form-control" placeholder="Any" min=0 step="any">
                <span>to</span>
                <input type="number" ng-model="search.weight_max" class="form-control" placeholder="Any" min=0 step="any">
                <select ng-model="search.weight_units">
                  <option value="">GSM</option>
                  <option value="glm">GLM</option>
                  <option value="osy">OSY</option>
                </select>
              </div>

              <div class="form-group">
                <label>Keywords</label>
                <input selectize="selectize.keywords" type="text" ng-model="search.keywords" class="form-control" placeholder="Type to search...">
              </div>
            </div>
          </fieldset>

          <a href="#" ng-click="advanced = !advanced">
            Toggle Advanced Options
          </a>

          <hr>

          <fieldset class="advanced-options" ng-show="advanced">
            <div class="row">
              <div class="form-group form-group-color">
                <label>Color</label>
                <input minicolors ng-model="search.color" class="form-control">
              </div>
            </div>
            <hr>
          </fieldset>

          <div class="form-actions">
            <button type="submit" class="btn btn-default">Search</button>
          </div>
        </form>
      </div>
    </div>

    <div ng-if="pagination && !items.loading">
      <div ng-switch="pagination.total_count">
        <div ng-switch-when="0">
          No results were found
        </div>
        <div ng-switch-when="1">
          Displaying 1 result
        </div>
        <div ng-switch-default>
          Displaying {{pagination.from}} to {{pagination.to}} of {{pagination.total_count}} results.
        </div>
      </div>

      <pagination 
        items-per-page="pagination.per_page" 
        max-size="10" 
        total-items="pagination.total_count" 
        ng-model="pagination.page"
        ng-change="updateSearch(pagination.page)"
      ></pagination>
    </div>

    <div ng-if="items.loading">
      Loading...
    </div>

    <ul class="fabric-variant-resultlist" ng-repeat="item in items">
      <li class="fabric-variant-result" style="background-color: #{{ item.color }};">
        <a ng-click="show(item.id)">
          <img ng-src="{{item.image.thumb}}">
        </a>
      </li>
    </ul>
  </script>

  <script type="text/ng-template" id="show.html">
    <div class="modal-header">
      <h3 class="modal-title">Fabric: {{ fabric_variant.id }}</h3>
    </div>
    <div class="modal-body">
      <img ng-src="{{ fabric_variant.image.thumb }}" />
      <p>color: #{{ fabric_variant.color }}</p>
    </div>
  </script>
</div>
